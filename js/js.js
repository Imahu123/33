typeof String.prototype.trimAll=="undefined"&&(String.prototype.trimAll=function(){return this.replace(/\s+/g,"")}),function(n,t,i){function s(n){return f.logPrefix.concat(n)}function h(n,t){return(t=t.toString(),n=n.toString(),!/^(\d{2}|\d{4})$/.test(t)||!/^\d{1,2}$/.test(n))?null:(t.length===2?"20"+t:t)+"-"+(n.length===1?"0"+n:n)+"-15"}function o(n){return/^\d/.test(n)}function u(n,t,i){this.ErrorCode=n;this.ErrorText=s(t);this.EventId=i;this.toString=function(){return this.ErrorText}}function e(n,t,i){return{Error:new u(n,t,i)}}if(typeof t=="undefined")throw"VivaPayments.js requires jQuery";n.version=230;n.NativeCheckoutVersion=200;var r=n.statusCode={OK:200,LOCKED:423,NOT_FOUND:404,BAD_REQUEST:400},f={baseURL:"https://api.vivapayments.com",logPrefix:"VivaPayments: "};n.MessageType={THREEDSECURE:"vp_sc_threedsecure"};n.getURLs=function(){return{cardtoken:f.baseURL.concat("/nativecheckout/v2/chargetokens"),installments:f.baseURL.concat("/nativecheckout/v2/installments")}};f.urls=n.getURLs();n.setBaseURL=function(t){t=t[t.length-1]==="/"?t.substring(0,t.length-1):t;f.baseURL=t;f.urls=n.getURLs()};n.PaymentsMessage=function(n,t){this.MessageType=n;this.MessageData=t};n.isMobileSafari=function(){var n=navigator.userAgent;return/(iPhone|iPad|iPod)/i.test(n)&&/Safari/i.test(n)},function(s){function y(n,i){if(n&&i){var u=t("<div/>").html(n).html(),r=document.getElementById(i);r=r.contentWindow||r.contentDocument.document||r.contentDocument;r.document.open();r.document.write(u);r.document.close()}}function a(){return{Authorization:"Bearer "+s.settings.options.authToken}}function v(n){var t=s.settings.options.cardHolderAuthOptions;typeof t!="undefined"&&typeof t[n]=="function"&&t[n]()}function p(){var n=c.cardnumber;if(s.settings.options.installmentsHandler)n.on("blur",function(){var n=t(this).val().trimAll(),r=s.settings.options.installmentsHandler,u;n!==l&&o(n)&&(u=t.extend({cardNumber:n},a()),t.ajax({url:f.urls.installments,method:"get",headers:u}).done(function(n){r({MaxInstallments:n.maxInstallments})}).fail(function(n){var t=null;n.responseJSON!=null&&(t=n.responseJSON.eventId);r(e(n.status,n.statusText,t))}).always(function(t){l=t.maxInstallments?n:i}))})}function w(n){if(typeof n=="undefined")throw new u(r.BAD_REQUEST,"No options have been set");if(!n.authToken||n.authToken.length===0)throw new u(r.BAD_REQUEST,"Authorization token not set");if(n.installmentsHandler&&typeof n.installmentsHandler!="function")throw new u(r.BAD_REQUEST,"installmentsHandler is not a function");if(n.cardHolderAuthOptions){if(t("#"+n.cardHolderAuthOptions.cardHolderAuthPlaceholderId).length===0)throw new u(r.BAD_REQUEST,"cardHolderAuthPlaceholderId is not defined");if(n.cardHolderAuthOptions.cardHolderAuthInitiated&&typeof n.cardHolderAuthOptions.cardHolderAuthInitiated!="function")throw new u(r.BAD_REQUEST,"cardHolderAuthInitiated is not a function");if(n.cardHolderAuthOptions.cardHolderAuthFinished&&typeof n.cardHolderAuthOptions.cardHolderAuthFinished!="function")throw new u(r.BAD_REQUEST,"cardHolderAuthFinished is not a function");}var i=!1;t.each(s.settings.requiredDataAttrs,function(n,f){var e;if(f!=="month"&&f!=="year"||!i)if((e=t('[data-vp="'+f+'"]')).length===0){if(f==="expdate")return;throw new u(r.NOT_FOUND,'Required data-vp attribute "'+f+'" was not found');}else if(e.length>1)throw new u(r.BAD_REQUEST,'Attribute violation. data-vp "'+f+'" was found multiple times');else f==="expdate"&&(i=!0),e.removeAttr("name"),c[f]=e});t.each(s.settings.optionalDataAttrs,function(n,i){var f;if((f=t('[data-vp="'+i+'"]')).length===1)c[i]=f;else if(f.length>1)throw new u(r.BAD_REQUEST,'Attribute violation. data-vp "'+i+'" was found multiple times');})}var c={},l=i;s.settings={requiredDataAttrs:["cardnumber","cardholder","cvv","expdate","month","year"],optionalDataAttrs:["friendlyname"]};s.setup=function(t){if(typeof t=="undefined")throw new u(r.BAD_REQUEST,"Null options");s.settings.options={authToken:t.authToken,baseURL:t.baseURL||f.baseURL,installmentsHandler:t.installmentsHandler,amount:t.amount,cardHolderAuthOptions:t.cardHolderAuthOptions};n.setBaseURL(s.settings.options.baseURL);w(s.settings.options);p()};s.requestToken=function(i){var p,w,u=t.Deferred(),d,b,g,l,k;for(d in c)c[d].removeAttr("name");if(!parseInt(i.amount)||i.amount<=0)return u.reject(e(r.BAD_REQUEST,"Invalid amount")).promise();if(typeof c.expdate!="undefined"){if(b=c.expdate.val().trimAll().split("/"),b.length!==2)return u.reject(e(r.BAD_REQUEST,"Expiration date could not be parsed")).promise();p=b[0];w=b[1]}else p=c.month.val(),w=c.year.val();return(g=h(p,w),g==null)?u.reject(e(r.BAD_REQUEST,"Expiration Date information could not be parsed")).promise():(l={Number:c.cardnumber.val().trimAll(),CVC:c.cvv.val(),HolderName:c.cardholder.val(),ExpirationYear:w,ExpirationMonth:p,Installments:i.installments,Amount:i.amount,AuthenticateCardholder:i.authenticateCardholder},typeof c.friendlyname!="undefined"&&(l.FriendlyName=c.friendlyname.val()),typeof c.token!="undefined"&&(l.Token=c.token.val()),!o(l.Number))?u.reject(e(r.BAD_REQUEST,"Invalid card number")).promise():l.HolderName.length===0?u.reject(e(r.BAD_REQUEST,"Cardholder cannot be empty")).promise():(typeof l.AuthenticateCardholder=="undefined"&&(l.AuthenticateCardholder=!0),k=f.urls.cardtoken,l.AuthenticateCardholder===!1&&(k+=":skipauth"),t.ajax({url:k,type:"POST",contentType:"application/json",headers:a(),data:JSON.stringify(l)}).done(function(i){var f={chargeToken:i.chargeToken},r;if(!i.redirectToACSForm){u.resolve(f);return}t("#threed-secure-frame").remove();r=t('<iframe id="threed-secure-frame" frameBorder="0">');r.css("height","100%");r.css("width","100%");t("#"+s.settings.options.cardHolderAuthOptions.cardHolderAuthPlaceholderId).append(r);y(i.redirectToACSForm,"threed-secure-frame");v("cardHolderAuthInitiated");t(window).on("message",function(t){var i={};try{i=JSON.parse(t.originalEvent.data)}catch(r){return}i.MessageType===n.MessageType.THREEDSECURE&&u.state()!=="resolved"&&(v("cardHolderAuthFinished"),u.resolve(f))})}).fail(function(n){var t=null;n.responseJSON!=null&&(t=n.responseJSON.eventId);u.reject(e(n.status,n.statusText,t))}),u.promise())}}(n.cards=n.cards||{})}(window.VivaPayments=window.VivaPayments||{},jQuery)